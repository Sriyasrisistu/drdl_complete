-- Oracle DB creation script for DRDL Fire Management System
-- Replace PASSWORD_PLACEHOLDER with a secure password before running

-- 1) Create user/schema
CREATE USER DRDL_USER IDENTIFIED BY "PASSWORD_PLACEHOLDER";
GRANT CREATE SESSION, CREATE TABLE, CREATE SEQUENCE, CREATE VIEW, CREATE PROCEDURE, CREATE TRIGGER TO DRDL_USER;
ALTER USER DRDL_USER QUOTA UNLIMITED ON USERS;

-- 2) Create tables (run as a privileged user or connect as DRDL_USER after creating user)
-- EMPLOYEE_DETAILS table
CREATE TABLE DRDL_USER.EMPLOYEE_DETAILS (
  EMP_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  EMPLOYEE_NAME VARCHAR2(100 CHAR) NOT NULL,
  PERSONNEL_NO VARCHAR2(6 CHAR) NOT NULL UNIQUE,
  DESIGNATION VARCHAR2(100 CHAR) NOT NULL,
  DIRECTORATE VARCHAR2(100 CHAR),
  DIVISION VARCHAR2(100 CHAR),
  ADDRESS VARCHAR2(300 CHAR),
  PHONE VARCHAR2(15 CHAR),
  EMAIL VARCHAR2(100 CHAR),
  PASSWORD VARCHAR2(255 CHAR),
  STATUS VARCHAR2(20 CHAR)
);

-- SAFETY_REQUEST table
CREATE TABLE DRDL_USER.SAFETY_REQUEST (
  REQUEST_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  UNIQUE_ID VARCHAR2(12 CHAR) UNIQUE,
  PERS_NO VARCHAR2(6 CHAR) NOT NULL,
  DATE_OF_REQUEST DATE,
  SAFETY_COVERAGE VARCHAR2(50 CHAR) NOT NULL,
  DIRECTORATE VARCHAR2(100 CHAR),
  DIVISION VARCHAR2(100 CHAR),
  INTEGRATION_FAC VARCHAR2(100 CHAR),
  ARTICLE_DETAILS VARCHAR2(500 CHAR),
  WORK_DESCRIPTION VARCHAR2(500 CHAR),
  ACT_INCHARGE_NAME VARCHAR2(100 CHAR),
  ACT_INCHARGE_ORG VARCHAR2(100 CHAR),
  ACT_INCHARGE_PHONE VARCHAR2(15 CHAR),
  DESIGNATION VARCHAR2(100 CHAR),
  ACTIVITY_FROM_DATE DATE,
  ACTIVITY_TO_DATE DATE,
  ACTIVITY_SCHEDULE VARCHAR2(3 CHAR),
  ACTIVITY_PDF BLOB,
  AMBULANCE_REQUIRED VARCHAR2(3 CHAR),
  OTHER_DETAILS VARCHAR2(500 CHAR),
  TEST_BED VARCHAR2(100 CHAR),
  TARB_CLEARANCE VARCHAR2(100 CHAR),
  REFERENCE_NO VARCHAR2(100 CHAR),
  TEST_CTRL_NAME VARCHAR2(100 CHAR),
  TEST_CTRL_DESIG VARCHAR2(100 CHAR),
  DATE_OF_TEST DATE,
  TEST_SCHEDULE_TIME VARCHAR2(8 CHAR),
  WORK_CENTRE VARCHAR2(100 CHAR),
  TRANSPORTATION VARCHAR2(100 CHAR),
  TRANS_SCHEDULE_TIME VARCHAR2(8 CHAR),
  TRANS_INCHARGE VARCHAR2(100 CHAR),
  VEHICLE_DETAILS VARCHAR2(100 CHAR),
  DRIVER_NAME VARCHAR2(100 CHAR),
  DRIVER_DESIG VARCHAR2(100 CHAR),
  DRIVER_AUTH VARCHAR2(3 CHAR),
  HEAD_SFEED_STATUS VARCHAR2(20 CHAR),
  WORK_ALLOCATED_TO VARCHAR2(100 CHAR),
  GD_TS_STATUS VARCHAR2(20 CHAR)
);

-- 3) Example index for faster lookup by personnel number
CREATE INDEX IDX_SAFETY_PERSNO ON DRDL_USER.SAFETY_REQUEST (PERS_NO);
CREATE INDEX IDX_EMP_PERSONNEL_NO ON DRDL_USER.EMPLOYEE_DETAILS (PERSONNEL_NO);

-- 4) (Optional) Grant privileges if using separate application DB user
-- GRANT SELECT, INSERT, UPDATE, DELETE ON DRDL_USER.SAFETY_REQUEST TO SOME_APP_USER;

-- Notes:
-- - After running this script, set environment variables used by the app:
--   ORACLE_URL=jdbc:oracle:thin:@//<HOST>:1521/<SERVICE>
--   ORACLE_USER=DRDL_USER
--   ORACLE_PASSWORD=<PASSWORD_PLACEHOLDER>
-- - The app expects Oracle 12c+ for IDENTITY support. If using older versions, create sequences/triggers for IDs.

-- Run as DRDL_USER (or add schema prefix DRDL_USER.)
-- Login note: your backend currently checks plain text PASSWORD + STATUS='ACTIVE'

-- 1) EMPLOYEE_DETAILS sample data
INSERT INTO EMPLOYEE_DETAILS
(EMPLOYEE_NAME, PERSONNEL_NO, DESIGNATION, DIRECTORATE, DIVISION, ADDRESS, PHONE, EMAIL, PASSWORD, STATUS)
VALUES
('Dr. Rajesh Kumar', '101001', 'Senior Scientist', 'Aeronautics', 'Flight Mechanics',
 'DRDL Campus, Hyderabad', '0401234567', 'rajesh.kumar@drdl.gov.in', 'pass123', 'ACTIVE');

INSERT INTO EMPLOYEE_DETAILS
(EMPLOYEE_NAME, PERSONNEL_NO, DESIGNATION, DIRECTORATE, DIVISION, ADDRESS, PHONE, EMAIL, PASSWORD, STATUS)
VALUES
('Ms. Priya Sharma', '101002', 'Scientist', 'Systems & Analysis', 'Control Systems',
 'DRDL Campus, Hyderabad', '0401234568', 'priya.sharma@drdl.gov.in', 'pass123', 'ACTIVE');

INSERT INTO EMPLOYEE_DETAILS
(EMPLOYEE_NAME, PERSONNEL_NO, DESIGNATION, DIRECTORATE, DIVISION, ADDRESS, PHONE, EMAIL, PASSWORD, STATUS)
VALUES
('Shri Vikram Singh', '101003', 'Senior Technical Officer', 'Structures', 'Materials',
 'DRDL Campus, Hyderabad', '0401234569', 'vikram.singh@drdl.gov.in', 'pass123', 'ACTIVE');

INSERT INTO EMPLOYEE_DETAILS
(EMPLOYEE_NAME, PERSONNEL_NO, DESIGNATION, DIRECTORATE, DIVISION, ADDRESS, PHONE, EMAIL, PASSWORD, STATUS)
VALUES
('Dr. Anita Verma', '101004', 'Principal Scientist', 'Propulsion', 'Engine Integration',
 'DRDL Campus, Hyderabad', '0401234570', 'anita.verma@drdl.gov.in', 'pass123', 'ACTIVE');

-- 2) SAFETY_REQUEST sample data
INSERT INTO SAFETY_REQUEST
(UNIQUE_ID, PERS_NO, DATE_OF_REQUEST, SAFETY_COVERAGE, DIRECTORATE, DIVISION,
 INTEGRATION_FAC, ARTICLE_DETAILS, WORK_DESCRIPTION, ACT_INCHARGE_NAME, ACT_INCHARGE_ORG, ACT_INCHARGE_PHONE,
 DESIGNATION, ACTIVITY_FROM_DATE, ACTIVITY_TO_DATE, ACTIVITY_SCHEDULE, AMBULANCE_REQUIRED,
 HEAD_SFEED_STATUS, WORK_ALLOCATED_TO, GD_TS_STATUS)
VALUES
('2026021701', '101001', TO_DATE('2026-02-17','YYYY-MM-DD'), 'integration', 'Aeronautics', 'Flight Mechanics',
 'Integration Bay-2', 'Missile section assembly', 'Final integration and checks',
 'Dr. Rajesh Kumar', 'DRDL', '0401234567',
 'Senior Scientist', TO_DATE('2026-02-18','YYYY-MM-DD'), TO_DATE('2026-02-19','YYYY-MM-DD'), 'DAY', 'YES',
 'RECOMMENDED', 'Safety Team-A', 'APPROVED');

INSERT INTO SAFETY_REQUEST
(UNIQUE_ID, PERS_NO, DATE_OF_REQUEST, SAFETY_COVERAGE, DIRECTORATE, DIVISION,
 TEST_BED, TARB_CLEARANCE, REFERENCE_NO, TEST_CTRL_NAME, TEST_CTRL_DESIG, DATE_OF_TEST, TEST_SCHEDULE_TIME,
 HEAD_SFEED_STATUS, WORK_ALLOCATED_TO, GD_TS_STATUS)
VALUES
('2026021702', '101002', TO_DATE('2026-02-17','YYYY-MM-DD'), 'static', 'Systems & Analysis', 'Control Systems',
 'Static Test Bed-1', 'TARB/CLR/2026/014', 'REF-ST-2201', 'Ms. Priya Sharma', 'Scientist',
 TO_DATE('2026-02-20','YYYY-MM-DD'), '10:30:00',
 'RECOMMENDED', 'Static Safety Cell', 'PENDING');

INSERT INTO SAFETY_REQUEST
(UNIQUE_ID, PERS_NO, DATE_OF_REQUEST, SAFETY_COVERAGE, DIRECTORATE, DIVISION,
 TRANSPORTATION, TRANS_SCHEDULE_TIME, TRANS_INCHARGE, VEHICLE_DETAILS, DRIVER_NAME, DRIVER_DESIG, DRIVER_AUTH,
 HEAD_SFEED_STATUS, WORK_ALLOCATED_TO, GD_TS_STATUS)
VALUES
('2026021703', '101003', TO_DATE('2026-02-17','YYYY-MM-DD'), 'transportation', 'Structures', 'Materials',
 'Internal Transfer', '14:00:00', 'Shri Vikram Singh', 'Ashok Leyland 6x6', 'R. Suresh', 'Driver', 'YES',
 'RECOMMENDED', 'Transport Safety Unit', 'APPROVED');

INSERT INTO SAFETY_REQUEST
(UNIQUE_ID, PERS_NO, DATE_OF_REQUEST, SAFETY_COVERAGE, DIRECTORATE, DIVISION,
 OTHER_DETAILS, HEAD_SFEED_STATUS, WORK_ALLOCATED_TO, GD_TS_STATUS)
VALUES
('2026021704', '101004', TO_DATE('2026-02-17','YYYY-MM-DD'), 'other', 'Propulsion', 'Engine Integration',
 'Hot-run preparation safety audit and emergency drill support',
 'NOT_RECOMMENDED', 'Special Review Board', 'PENDING');

COMMIT;

 --verify :
 SELECT PERSONNEL_NO, EMPLOYEE_NAME, STATUS FROM EMPLOYEE_DETAILS ORDER BY PERSONNEL_NO;
SELECT UNIQUE_ID, PERS_NO, SAFETY_COVERAGE, HEAD_SFEED_STATUS, GD_TS_STATUS FROM SAFETY_REQUEST ORDER BY REQUEST_ID;
